# AISAC Agent Configuration

agent:
  # Agent ID (auto-generated if empty)
  id: ""
  # Labels for agent grouping/filtering
  labels:
    - production
    - webserver
  # Heartbeat interval
  heartbeat_interval: 30s
  # Initial reconnect delay
  reconnect_delay: 5s
  # Maximum reconnect delay
  max_reconnect_delay: 5m

server:
  # Command server WebSocket URL
  url: "wss://localhost:8443/ws"
  # Connection timeout
  connect_timeout: 30s
  # Write timeout
  write_timeout: 10s
  # Read timeout
  read_timeout: 60s

tls:
  # Enable mTLS
  enabled: true
  # Agent certificate
  cert_file: "/etc/aisac/certs/agent.crt"
  # Agent private key
  key_file: "/etc/aisac/certs/agent.key"
  # CA certificate
  ca_file: "/etc/aisac/certs/ca.crt"
  # Skip certificate verification (NOT RECOMMENDED)
  skip_verify: false

actions:
  # Enabled actions (only these will be executed)
  enabled:
    - block_ip
    - unblock_ip
    - isolate_host
    - unisolate_host
    - disable_user
    - enable_user
    - kill_process
    # - collect_forensics
    # - threat_hunt

  # Rate limits per action
  rate_limits:
    block_ip:
      max_per_minute: 10
      max_per_hour: 100
    isolate_host:
      max_per_minute: 1
      max_per_hour: 5
    disable_user:
      max_per_minute: 5
      max_per_hour: 50

  # Default action timeout
  default_timeout: 5m

# SOAR/n8n callback configuration
callback:
  # Enable callbacks to SOAR
  enabled: false
  # Webhook URL (n8n, SOAR platform, etc.)
  url: "https://n8n.example.com/webhook/aisac-callback"
  # Bearer token for authentication
  auth_token: ""
  # Request timeout
  timeout: 30s
  # Number of retry attempts on failure
  retry_attempts: 3
  # Delay between retries
  retry_delay: 5s
  # Skip TLS verification (NOT RECOMMENDED)
  skip_tls_verify: false

# Heartbeat configuration (status reporting to AISAC platform)
heartbeat:
  # Enable heartbeat reporting
  enabled: true
  # AISAC Platform heartbeat endpoint
  url: "https://api.aisac.cisec.es/v1/heartbeat"
  # API Key for authentication (format: aisac_xxxx...)
  # Get this from the AISAC Platform when registering this asset
  api_key: "aisac_your_api_key_here"
  # Asset ID (UUID from AISAC Platform)
  # This identifies the monitored asset in the platform
  asset_id: "your-asset-uuid-here"
  # Heartbeat interval (server can override via response)
  interval: 120s
  # Request timeout
  timeout: 10s
  # Skip TLS verification (NOT RECOMMENDED)
  skip_tls_verify: false

# Log collector configuration (SIEM functionality)
collector:
  # Enable log collection
  enabled: false

  # Tenant ID (OPTIONAL) - For multi-tenant environments
  # When using API Key authentication, the tenant is automatically
  # derived from the monitored_asset associated with the API Key.
  # Only set this if you need to override the automatic tenant detection.
  # tenant_id: ""

  # Log sources to collect
  sources:
    # Suricata EVE JSON logs
    - name: suricata
      type: file
      path: /var/log/suricata/eve.json
      parser: suricata_eve
      tags:
        - security
        - ids

    # System syslog
    - name: syslog
      type: file
      path: /var/log/syslog
      parser: syslog
      tags:
        - system

    # Generic JSON logs
    # - name: app_logs
    #   type: file
    #   path: /var/log/myapp/*.json
    #   parser: json
    #   tags:
    #     - application

  # Output configuration
  output:
    # Output type: http
    type: http
    # Ingest endpoint URL
    url: "https://api.aisac.cisec.es/functions/v1/syslog-ingest"
    # API Key for authentication (format: aisac_xxxx...)
    # Get this from the AISAC Platform when registering this asset
    api_key: "aisac_your_api_key_here"
    # Request timeout
    timeout: 30s
    # Number of retry attempts
    retry_attempts: 3
    # Delay between retries
    retry_delay: 5s
    # Skip TLS verification (NOT RECOMMENDED)
    skip_tls_verify: false

  # Batching configuration
  batch:
    # Number of events per batch
    size: 100
    # Maximum time before flushing (even if batch not full)
    interval: 5s

  # File reading configuration
  file:
    # Start position for new files: "end" or "beginning"
    start_position: end
    # Path to store file positions (for resume after restart)
    sincedb_path: /var/lib/aisac/sincedb.json

logging:
  # Log level: debug, info, warn, error
  level: "info"
  # Log format: json, text
  format: "json"
  # Output: stdout, file
  output: "stdout"
  # Log file path (when output is "file")
  file: "/var/log/aisac/agent.log"
